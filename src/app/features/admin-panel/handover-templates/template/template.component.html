<div class="container">
    @if(selectedTemplate){
        <div Id="templatePanel" class="panel panel-primary">
            <div class="panel-heading clearfix">
                <span class="panel-title"> {{selectedTemplate.name}}</span>
            </div>
            <div class="report-panel">
                <div Id="section">
                    @for (section of sections; track section; let i = $index) {
                        <div class="panel-body grey-panel">
                            <div class="navbar navbar-blue">
                                <div class="navbar-inline">
                                    <span class="label">{{section.sectionName}}</span>
                                    @if(!section.iHandoverSection){
                                        <span class="editSection" (click)="editSectionDialog(section)"></span>
                                        <span class="removeSection" (click)="deleteSectionDialog(section)"></span>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="navbar navbar-white">
                            <div class="table-block">

                                <div class="table">
                                    <div class="headRow">
                                      <div class="actions-title">Actions</div>
                                      <div class="type-title">Topic</div>
                                      <div class="reference-title">Reference</div>
                                      <div class="notes-title">Notes</div>
                                    </div>
    
                                    <div class="rowTopicData" cdkDropList
                                        (cdkDropListDropped)="dropTopic($event,  section.sectionTopics, section)">
                    
                                        @for (topic of section.sectionTopics; track topic) {

                                            <div class="divRow" cdkDrag cdkDragLockAxis="y" [cdkDragData]="topic">
                                                <div class="actions-body">
                                                    <div class="btn btn-circle draganddrop">
                                                        <mat-icon class="dragCursor">reorder</mat-icon>
                                                    </div>
                                                    <div class="btn btn-circle remove-btn">
                                                        <span class="glyphicon span"></span>
                                                    </div>
                                                    <div class="btn btn-circle edit-btn">
                                                        <span class="glyphicon span"></span>
                                                    </div>
                                                </div>
                                                <div class="type-body">
                                                  <span>{{topic.name}}</span>
                                                 @if(expanded(topic)){
                                                    <mat-icon class="mat-icon-rtl-mirror"
                                                    (click)="topic.isExpand = !topic.isExpand">
                                                    {{topic.isExpand ? 'expand_more' : 'chevron_right'}}
                                                    </mat-icon>
                                                 }
                                                 
                                                </div>
                                                <div class="reference-body">
                                                  ({{getCountReferences(topic)}})
                                                </div>
                                                <div class="notes-body"></div>
                                            </div>
                                          @if(topic.isExpand){
                                                <div cdkDropList class="rowReferenceData"
                                                (cdkDropListDropped)="dropReference($event, topic.references, section)">

                                                    @for(reference of topic.references; track reference){

                                                        <div class="divTopicRow" cdkDrag cdkDragLockAxis="y" [cdkDragData]="reference">
                                                        <div class="actions-body">
                                                            <div class="btn btn-circle draganddrop">
                                                                <mat-icon class="dragCursor">reorder</mat-icon>
                                                            </div>
                                                            <div class="btn btn-circle remove-btn">
                                                                <span class="glyphicon span"></span>
                                                            </div>
                                                            <div class="btn btn-circle edit-btn">
                                                                <span class="glyphicon span"></span>
                                                            </div>
                                                        </div>
                                                        <div class="type-body"></div>
                                                        <div class="reference-body tr-blue-text">
                                                            <span>{{reference.name}}</span>
                                                        </div>
                                                        <div class="notes-body">
                                                            <span>{{reference.description}}</span>
                                                        </div>
                                                        </div>
                                                    }
                                                </div>
                                            }
                                        }
                    
                                    </div>
                                    
                                    <div #addRowElement style="display:none;" class="rowTopicData">
                                        <div class="divRow">
                                            <div class="actions-body">
                                                <div class="btn btn-circle draganddrop">
                                                </div>
                                                <div class="btn btn-circle cancel-btn" (click)="addHideRowTopicForm(section,i)">
                                                    <span class="glyphicon span"></span>
                                                </div>
                                            </div>

                                            <form [formGroup]="topicForm" class="add-topic-form">
                                                <div class="type-body">
                                                    <mat-form-field class="example-full-width">
                                                        <input
                                                          type="text"
                                                          placeholder="Select/Add Topic"
                                                          matInput
                                                          formControlName="topicName"
                                                          [matAutocomplete]="autoRef"
                                                        />
                                                        <mat-autocomplete autoActiveFirstOption #autoRef="matAutocomplete"
                                                        [displayWith]="displayFn" (optionSelected)="onSelectAddTopic($event)">
                                                            @for (topic of section.sectionTopics; track topic) {
                                                                <mat-option [value]="topic">{{topic.name}}</mat-option>
                                                            }
                                                        </mat-autocomplete>
                                                      </mat-form-field>
                                                </div>
                                                <div class="reference-body">
                                                  <mat-form-field class="example-full-width">
                                                    <input
                                                    type="text"
                                                    placeholder="Select/Add Reference"
                                                    matInput
                                                    formControlName="referenceName"
                                                    [matAutocomplete]="auto"
                                                  />
                                                  <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete"
                                                  [displayWith]="displayRefFn" (optionSelected)="onSelectAddReference($event)">
                                                      @for (reference of references; track reference) {
                                                          <mat-option [value]="reference">{{reference.name}}</mat-option>
                                                      }
                                                  </mat-autocomplete>
                                                  </mat-form-field>
                                                </div>
                                                <div class="notes-body">
                                                  <mat-form-field class="example-full-width">
                                                      <textarea matInput
                                                            cdkTextareaAutosize
                                                            placeholder="Notes"
                                                            #autosize="cdkTextareaAutosize"
                                                            cdkAutosizeMinRows="1"
                                                            formControlName="description" 
                                                            cdkAutosizeMaxRows="5"></textarea>
                                                  </mat-form-field>
                                                </div>
                                                <div class="intel-body">
                                                    <button type="button" class="inline-add-btn" trigger="hover focus" side="top" delay="1000">
                                                        Add
                                                    </button>
                                                </div>
                                            </form>

                                        </div>
                                    </div>
                                    @if(section.addBtnShow){
                                        <div class="navbar navbar-white">
                                            <div type="button" class="btn-plus center-block" (click)="addHideRowTopicForm(section,i)">Add Topic</div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div> 
                    }
                    <div class="panel-body grey-panel">
                        <div class="navbar navbar-blue"></div>
                    </div>
                    <div class="navbar navbar-white">
                        <div type="button" class="add-section center-block" (click)="createSectionDialog(selectedTemplate.id)">Add Section</div>
                    </div>
                </div>
            </div>
        </div>
     }
</div>

